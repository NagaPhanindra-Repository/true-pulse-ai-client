<div class="memory-dashboard">
  <!-- Header Section -->
  <div class="dashboard-header">
    <div class="header-content">
      <div class="title-section">
        <div class="icon-wrapper">
          <svg width="48" height="48" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
            <defs>
              <linearGradient id="memoryGradient" x1="0" y1="0" x2="1" y2="1">
                <stop offset="0%" stop-color="#a78bfa"/>
                <stop offset="100%" stop-color="#3b82f6"/>
              </linearGradient>
            </defs>
            <circle cx="24" cy="24" r="20" fill="url(#memoryGradient)" opacity="0.2"/>
            <path d="M24 8C15.163 8 8 15.163 8 24s7.163 16 16 16 16-7.163 16-16S32.837 8 24 8zm0 28c-6.627 0-12-5.373-12-12S17.373 12 24 12s12 5.373 12 12-5.373 12-12 12z" fill="url(#memoryGradient)"/>
            <circle cx="24" cy="24" r="4" fill="#a78bfa" class="pulse-dot"/>
            <path d="M24 18v-4M24 34v-4M30 24h4M14 24h4" stroke="#6ee7b7" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </div>
        <div>
          <h1 class="ai-gradient">Feature Memory</h1>
          <p class="subtitle">Never miss a detail. Every decision, every edge case, perfectly remembered.</p>
        </div>
      </div>
      <button class="btn-create" (click)="openWizard()" [disabled]="integrations.length === 0">
        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
          <path d="M10 4v12M4 10h12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
        Record New Memory
      </button>
    </div>

    <!-- Tab Navigation -->
    <div class="tab-navigation">
      <button 
        class="tab-btn" 
        [class.active]="activeTab === 'integrations'"
        (click)="activeTab = 'integrations'">
        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
          <path d="M3 5h14a1 1 0 011 1v10a1 1 0 01-1 1H3a1 1 0 01-1-1V6a1 1 0 011-1z" stroke="currentColor" stroke-width="1.5"/>
          <path d="M14 5V3a1 1 0 00-1-1H7a1 1 0 00-1 1v2" stroke="currentColor" stroke-width="1.5"/>
        </svg>
        Integrations {{ integrations.length > 0 ? '(' + integrations.length + ')' : '' }}
      </button>
      <button 
        class="tab-btn" 
        [class.active]="activeTab === 'memories'"
        (click)="activeTab = 'memories'">
        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
          <path d="M4 4h12a1 1 0 011 1v10a1 1 0 01-1 1H4a1 1 0 01-1-1V5a1 1 0 011-1z" stroke="currentColor" stroke-width="1.5"/>
          <path d="M6 8h8M6 12h8" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
        </svg>
        Memories {{ totalElements > 0 ? '(' + totalElements + ')' : '' }}
      </button>
    </div>
  </div>

  <!-- ===== INTEGRATIONS TAB ===== -->
  <div class="tab-content" *ngIf="activeTab === 'integrations'">
    <!-- Integration Modal -->
    <div class="modal-overlay" *ngIf="showIntegrationModal" (click)="closeIntegrationModal()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <button class="modal-close" (click)="closeIntegrationModal()">×</button>
        <h2>Connect Jira Integration</h2>
        
        <div class="form-group">
          <label>Integration Name (optional)</label>
          <input 
            type="text" 
            [(ngModel)]="integrationForm.name"
            placeholder="e.g., My Jira Cloud"
            class="form-input">
        </div>

        <div class="form-group">
          <label>Jira URL *</label>
          <input 
            type="url" 
            [(ngModel)]="integrationForm.jiraUrl"
            placeholder="https://your-domain.atlassian.net"
            class="form-input">
          <small>Your Jira Cloud base URL</small>
        </div>

        <div class="form-group">
          <label>Email Address *</label>
          <input 
            type="email" 
            [(ngModel)]="integrationForm.jiraEmail"
            placeholder="your-email@example.com"
            class="form-input">
        </div>

        <div class="form-group">
          <label>API Token *</label>
          <input 
            type="password" 
            [(ngModel)]="integrationForm.apiToken"
            placeholder="Jira API Token"
            class="form-input">
          <small><a href="https://id.atlassian.com/manage-profile/security/api-tokens" target="_blank">Get API token</a></small>
        </div>

        <!-- Connection Status -->
        <div class="connection-status" *ngIf="connectionTested">
          <div [class]="connectionSuccess ? 'status-success' : 'status-error'">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
              <circle cx="8" cy="8" r="6" [attr.stroke]="connectionSuccess ? '#6ee7b7' : '#ef4444'" stroke-width="1.5"/>
              <path *ngIf="connectionSuccess" d="M5 8l2 2 4-4" stroke="#6ee7b7" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              <path *ngIf="!connectionSuccess" d="M8 5v6M5 8h6" stroke="#ef4444" stroke-width="1.5" stroke-linecap="round"/>
            </svg>
            <span>{{ connectionSuccess ? 'Connection verified ✓' : 'Connection failed ✗' }}</span>
          </div>
        </div>

        <div class="form-error" *ngIf="integrationError">
          {{ integrationError }}
        </div>

        <!-- Form Actions -->
        <div class="form-actions">
          <button 
            class="btn-test" 
            (click)="testIntegrationConnection()"
            [disabled]="testConnectionLoading">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
              <circle cx="8" cy="8" r="6" stroke="currentColor" stroke-width="1.5"/>
            </svg>
            {{ testConnectionLoading ? 'Testing...' : 'Test Connection' }}
          </button>

          <button 
            class="btn-primary" 
            (click)="createIntegration()"
            [disabled]="!connectionSuccess || integrationLoading">
            {{ integrationLoading ? 'Creating...' : 'Create Integration' }}
          </button>
        </div>
      </div>
    </div>

    <!-- Integrations List -->
    <div class="integrations-section">
      <div class="section-header">
        <h2>Jira Integrations</h2>
        <p class="section-desc">Connect your Jira workspace to link feature memories to stories</p>
      </div>

      <!-- Empty State -->
      <div class="empty-state" *ngIf="integrations.length === 0">
        <div class="empty-illustration">
          <svg width="120" height="120" viewBox="0 0 120 120" fill="none">
            <defs>
              <linearGradient id="jiraGradient" x1="0" y1="0" x2="1" y2="1">
                <stop offset="0%" stop-color="#a78bfa" opacity="0.3"/>
                <stop offset="100%" stop-color="#3b82f6" opacity="0.3"/>
              </linearGradient>
            </defs>
            <circle cx="60" cy="60" r="50" fill="url(#jiraGradient)"/>
            <rect x="35" y="35" width="50" height="50" rx="8" stroke="#a78bfa" stroke-width="2"/>
            <path d="M50 55h20M50 65h20" stroke="#6ee7b7" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </div>
        <h3>No Jira Integrations Yet</h3>
        <p>Connect your Jira workspace to start recording feature memories linked to your stories.</p>
        <button class="btn-integrate" (click)="openIntegrationModal()">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
            <path d="M10 4v12M4 10h12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
          Add Jira Integration
        </button>
      </div>

      <!-- Integrations Grid -->
      <div class="integrations-grid" *ngIf="integrations.length > 0">
        <div class="integration-card glassy-card" *ngFor="let integration of integrations">
          <div class="integration-header">
            <div>
              <h3>{{ integration.name || 'Jira Integration' }}</h3>
              <p class="integration-url">{{ integration.jiraUrl }}</p>
            </div>
            <div class="integration-status" [class.active]="integration.isActive">
              <span class="status-dot"></span>
              {{ integration.isActive ? 'Active' : 'Inactive' }}
            </div>
          </div>

          <div class="integration-info">
            <div class="info-item">
              <span class="info-label">Email:</span>
              <span class="info-value">{{ integration.jiraEmail }}</span>
            </div>
            <div class="info-item">
              <span class="info-label">Projects</span>
              <span class="info-value">{{ integration.projectKeys.length || 0 }} connected</span>
            </div>
            <div class="info-item">
              <span class="info-label">Last Sync:</span>
              <span class="info-value">{{ integration.lastSyncAt ? (integration.lastSyncAt | date:'short') : 'Never' }}</span>
            </div>
          </div>

          <div class="integration-actions">
            <button 
              class="btn-test" 
              (click)="testConnection(integration.id)">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                <circle cx="8" cy="8" r="6" stroke="currentColor" stroke-width="1.5"/>
              </svg>
              Test
            </button>
            <button 
              class="btn-delete" 
              (click)="deleteIntegration(integration.id)">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                <path d="M3 4h10M6 6v5M10 6v5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
              </svg>
              Delete
            </button>
          </div>
        </div>

        <div class="add-integration-card glassy-card">
          <button class="btn-add-integration" (click)="openIntegrationModal()">
            <svg width="40" height="40" viewBox="0 0 40 40" fill="none">
              <circle cx="20" cy="20" r="18" stroke="currentColor" stroke-width="1.5" stroke-dasharray="4 2"/>
              <path d="M20 12v16M12 20h16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
            Add Another Integration
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- ===== MEMORIES TAB ===== -->
  <div class="tab-content" *ngIf="activeTab === 'memories'">
    <!-- Search and Filter Bar -->
    <div class="search-filter-bar">
      <div class="search-box">
        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" class="search-icon">
          <circle cx="9" cy="9" r="5" stroke="currentColor" stroke-width="2"/>
          <path d="M13 13l4 4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
        <input 
          type="text" 
          placeholder="Search by story key, title, or description..." 
          [(ngModel)]="searchQuery"
          (keyup.enter)="onSearch()"
          class="search-input"
        />
        <button class="search-btn" (click)="onSearch()" *ngIf="searchQuery">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
            <path d="M12 4L4 12M4 4l8 8" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </button>
      </div>

      <div class="filter-group">
        <label class="filter-label">Status:</label>
        <select [(ngModel)]="selectedStatus" (change)="onFilterChange()" class="filter-select">
          <option value="all">All Status</option>
          <option value="active">Active</option>
          <option value="completed">Completed</option>
          <option value="archived">Archived</option>
        </select>
      </div>

      <div class="results-count" *ngIf="!loading">
        <span class="count-number">{{ totalElements }}</span> 
        <span class="count-label">{{ totalElements === 1 ? 'memory' : 'memories' }}</span>
      </div>
    </div>

  <!-- Loading State -->
  <div class="loading-state" *ngIf="loading">
    <div class="spinner">
      <svg width="50" height="50" viewBox="0 0 50 50">
        <circle cx="25" cy="25" r="20" stroke="url(#memoryGradient)" stroke-width="4" fill="none" stroke-dasharray="80, 200" stroke-linecap="round">
          <animateTransform attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="1s" repeatCount="indefinite"/>
        </circle>
      </svg>
    </div>
    <p class="loading-text">Loading memories...</p>
  </div>

  <!-- Error State -->
  <div class="error-state glassy-card" *ngIf="error && !loading">
    <svg width="48" height="48" viewBox="0 0 48 48" fill="none">
      <circle cx="24" cy="24" r="20" stroke="#ef4444" stroke-width="2"/>
      <path d="M24 16v12M24 32v2" stroke="#ef4444" stroke-width="2" stroke-linecap="round"/>
    </svg>
    <p class="error-text">{{ error }}</p>
    <button class="btn-retry" (click)="loadMemories()">Try Again</button>
  </div>

  <!-- Empty State -->
  <div class="empty-state" *ngIf="!loading && !error && memories.length === 0">
    <div class="empty-illustration">
      <svg width="200" height="200" viewBox="0 0 200 200" fill="none">
        <defs>
          <linearGradient id="emptyGradient" x1="0" y1="0" x2="1" y2="1">
            <stop offset="0%" stop-color="#a78bfa" opacity="0.3"/>
            <stop offset="100%" stop-color="#3b82f6" opacity="0.3"/>
          </linearGradient>
        </defs>
        <circle cx="100" cy="100" r="80" fill="url(#emptyGradient)"/>
        <path d="M100 60v80M60 100h80" stroke="#a78bfa" stroke-width="4" stroke-linecap="round" opacity="0.5"/>
        <circle cx="100" cy="100" r="20" fill="none" stroke="#6ee7b7" stroke-width="3" stroke-dasharray="10, 5"/>
      </svg>
    </div>
    <h3 class="empty-title">No Memories Yet</h3>
    <p class="empty-description">
      Start recording feature memories to ensure your development team never misses critical context, 
      edge cases, or important decisions.
    </p>
    <button class="btn-create-large" (click)="openWizard()">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
        <path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      </svg>
      Create Your First Memory
    </button>
  </div>

  <!-- Memory Grid -->
  <div class="memory-grid" *ngIf="!loading && !error && memories.length > 0">
    <div class="memory-card glassy-card" *ngFor="let memory of memories" [routerLink]="['/memories', memory.id]">
      <!-- Card Header -->
      <div class="card-header">
        <div class="story-info">
          <span class="story-key">{{ memory.jiraStoryKey }}</span>
          <span class="status-badge" [ngClass]="getStatusClass(memory.status)">
            {{ getStatusLabel(memory.status) }}
          </span>
        </div>
        <div class="card-actions">
          <button class="action-btn" (click)="$event.stopPropagation()">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
              <circle cx="10" cy="5" r="1.5" fill="currentColor"/>
              <circle cx="10" cy="10" r="1.5" fill="currentColor"/>
              <circle cx="10" cy="15" r="1.5" fill="currentColor"/>
            </svg>
          </button>
        </div>
      </div>

      <!-- Card Title -->
      <h3 class="card-title">{{ memory.jiraStoryTitle }}</h3>

      <!-- Card Description -->
      <p class="card-description">{{ memory.initialDescription | slice:0:150 }}{{ memory.initialDescription.length > 150 ? '...' : '' }}</p>

      <!-- Card Footer -->
      <div class="card-footer">
        <div class="discussion-count">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
            <path d="M2 2h12v9H5l-3 3V2z" stroke="currentColor" stroke-width="1.5" stroke-linejoin="round"/>
          </svg>
          <span>{{ memory.discussionCount || 0 }} {{ memory.discussionCount === 1 ? 'note' : 'notes' }}</span>
        </div>
        <div class="date-info">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
            <circle cx="8" cy="8" r="6" stroke="currentColor" stroke-width="1.5"/>
            <path d="M8 4v4l3 2" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
          </svg>
          <span>{{ formatDate(memory.updatedAt) }}</span>
        </div>
      </div>

      <!-- Hover Effect Overlay -->
      <div class="card-overlay">
        <span class="view-details">View Details →</span>
      </div>
    </div>
  </div>

  <!-- Pagination -->
  <div class="pagination" *ngIf="!loading && !error && totalPages > 1">
    <button 
      class="pagination-btn" 
      [disabled]="currentPage === 0"
      (click)="previousPage()">
      <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
        <path d="M12 4l-6 6 6 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      Previous
    </button>

    <div class="pagination-numbers">
      <button 
        *ngFor="let page of paginationRange"
        class="pagination-number"
        [class.active]="page === currentPage"
        (click)="goToPage(page)">
        {{ page + 1 }}
      </button>
    </div>

    <button 
      class="pagination-btn" 
      [disabled]="currentPage >= totalPages - 1"
      (click)="nextPage()">
      Next
      <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
        <path d="M8 4l6 6-6 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </button>
  </div>

  <!-- Memory Creation Wizard Modal -->
  <app-memory-creation-wizard 
    *ngIf="showWizard"
    (onClose)="closeWizard()"
    (onSuccess)="onWizardSuccess($event)"
  />
  </div><!-- Close memories tab-content -->
</div>
