<div class="followers-root">
  <div style="height: 96px;"></div> <!-- Increased spacer from header -->
  <div class="animated-bg">
    <!-- Dynamic animated SVG/canvas background for best-in-class look -->
    <svg viewBox="0 0 1600 400" class="followers-bg-svg">
      <defs>
        <linearGradient id="followers-gradient" x1="0" y1="0" x2="1" y2="1">
          <stop offset="0%" stop-color="#6ee7b7"/>
          <stop offset="100%" stop-color="#a78bfa"/>
        </linearGradient>
      </defs>
      <circle cx="300" cy="200" r="80" fill="url(#followers-gradient)" opacity="0.13">
        <animate attributeName="r" values="80;120;80" dur="3s" repeatCount="indefinite"/>
      </circle>
      <circle cx="1200" cy="120" r="60" fill="#a78bfa" opacity="0.10">
        <animate attributeName="r" values="60;90;60" dur="2.5s" repeatCount="indefinite"/>
      </circle>
      <circle cx="900" cy="300" r="40" fill="#6ee7b7" opacity="0.10">
        <animate attributeName="r" values="40;70;40" dur="2.2s" repeatCount="indefinite"/>
      </circle>
      <path d="M0,350 Q800,100 1600,350" stroke="#a78bfa" stroke-width="6" fill="none" opacity="0.08">
        <animate attributeName="d" values="M0,350 Q800,100 1600,350;M0,350 Q800,200 1600,350;M0,350 Q800,100 1600,350" dur="4s" repeatCount="indefinite"/>
      </path>
    </svg>
  </div>

  <div class="followers-content">
    <h1 class="followers-title">Your Following & Their Questions</h1>
    <div *ngIf="loading" class="followers-loading">Loading...</div>
    <div *ngIf="error" class="followers-error">{{ error }}</div>

    <div class="followers-section">
      <h2 class="followers-subtitle">Questions from Users You Follow</h2>
      <div class="followers-questions-list">
        <div *ngFor="let q of questions" class="followers-question-card">
          <div class="question-header question-bg">
            <div class="question-title-row">
              <span class="question-title">{{ q.questionTitle }}</span>
              <button *ngIf="!q.loggedInUserAnswer" class="respond-btn-inline" (click)="openRespondModal(q)">
                <svg width="18" height="18" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg" style="vertical-align: middle; margin-right: 4px;">
                  <path d="M2.5 10L8.5 4V8.5C15 8.5 17.5 13.5 17.5 13.5C15.5 11.5 12.5 11.5 8.5 11.5V16L2.5 10Z" stroke="#6ee7b7" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                Respond
              </button>
            </div>
            <span class="question-meta">by {{ q.questionCreatorFirstName }} {{ q.questionCreatorLastName }} ({{ q.questionCreatorUsername }})</span>
            <div class="question-desc question-bg">{{ q.questionDescription }}</div>
            <!-- <span class="question-date">{{ q.questionCreatedAt | date:'medium' }}</span> -->
          </div>
          
          <div class="question-answers">
            <ng-container *ngIf="q.loggedInUserAnswer">
              <div class="answer-connector">
                <div class="connector-line"></div>
                <div class="answer-bg">
                  <ng-container *ngIf="editingAnswerId !== q.loggedInUserAnswer.answerId; else editAnswerBlock">
                    <div style="display: flex; align-items: center; gap: 8px;">
                      <span class="answer-label">Your Answer:</span>
                      <span class="answer-content">{{ q.loggedInUserAnswer.answerContent }}</span>
                      <span class="edit-icon" title="Edit" (click)="startEditAnswer(q)" style="margin-left: auto;">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                          <path d="M4 13.5V16H6.5L14.87 7.63L12.37 5.13L4 13.5Z" stroke="#a78bfa" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                          <path d="M15.73 6.04C16.1 5.67 16.1 5.09 15.73 4.72L15.28 4.27C14.91 3.9 14.33 3.9 13.96 4.27L13.13 5.1L15.63 7.6L15.73 6.04Z" stroke="#a78bfa" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                      </span>
                    </div>
                  </ng-container>
                <ng-template #editAnswerBlock>
                  <textarea [(ngModel)]="editAnswerContent" class="edit-answer-textarea"></textarea>
                  <div class="edit-actions">
                    <button class="icon-btn" (click)="saveEditAnswer(q)" [disabled]="editSubmitting" title="Save">
                      <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M5 10.5L9 14.5L15 7.5" stroke="#6ee7b7" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                      </svg>
                    </button>
                    <button class="icon-btn" (click)="cancelEditAnswer()" title="Cancel">
                      <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M6 6L14 14M14 6L6 14" stroke="#f87171" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                      </svg>
                    </button>
                  </div>
                  <div class="modal-error" *ngIf="editError">{{ editError }}</div>
                </ng-template>
                </div>
              </div>
            </ng-container>
           
          </div>
        </div>
      </div>
    </div>

    <div class="followers-section">
      <h2 class="followers-subtitle">Users You Follow</h2>
      <div class="followers-users-list">
        <div *ngFor="let user of followingUsers" class="followers-user-card">
          <div class="user-avatar">{{ user.firstName[0] }}{{ user.lastName[0] }}</div>
          <div class="user-info">
            <div class="user-name">{{ user.firstName }} {{ user.lastName }}</div>
            <div class="user-username">{{ user.username }}</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal for feedback/answer -->
  <div class="modal-backdrop" *ngIf="showModal" (click)="closeModal()"></div>
  <div class="modal custom-modal" *ngIf="showModal">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <h2>Respond to: {{ selectedQuestion?.questionTitle }}</h2>
      <form [formGroup]="feedbackForm" (ngSubmit)="submitFeedback()" novalidate>
        <textarea formControlName="content" placeholder="Your answer or feedback..." rows="4"
          [class.invalid-input]="formTouched && (!feedbackForm.value.content || !feedbackForm.value.content.trim())"></textarea>
        <div class="modal-actions">
          <button type="button" (click)="closeModal()">Cancel</button>
          <button type="submit" [disabled]="submitting || !feedbackForm.value.content || !feedbackForm.value.content.trim()">
            {{ submitting ? 'Submitting...' : 'Submit' }}
          </button>
        </div>
        <div class="modal-error" *ngIf="submitError">{{ submitError }}</div>
      </form>
      <style>
        .invalid-input {
          border: 1.5px solid #f87171 !important;
          background: #fff0f0;
        }
      </style>
    </div>
  </div>

  <div style="height: 64px;"></div> <!-- Spacer from footer -->
</div>
